---
phase: 01-capture-infrastructure-proof-of-concept
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [Cargo.toml, tauri.conf.json, src/main.rs]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Tauri 2.0 project initializes and runs without errors"
    - "Application window displays with basic content"
    - "Dependencies install successfully without errors"
  artifacts:
    - path: "Cargo.toml"
      provides: "Rust project dependencies"
      contains: "[dependencies]"
    - path: "src/main.rs"
      provides: "Tauri application entry point"
      contains: "fn main"
    - path: "tauri.conf.json"
      provides: "Tauri application configuration"
      contains: "tauri"
  key_links:
    - from: "Cargo.toml"
      to: "crates.io"
      via: "dependency declarations"
      pattern: "^(windivert|tokio|tauri|windows|thiserror|tracing|serde)\\s*="
    - from: "src/main.rs"
      to: "tauri::Builder"
      via: "application builder pattern"
      pattern: "tauri::Builder::default\\(\\)"
---

<objective>
Initialize Tauri 2.0 desktop application with all required dependencies for packet capture infrastructure.

Purpose: Establish project foundation with proper tooling and dependency configuration before implementing capture logic.
Output: Running Tauri application skeleton with window UI.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-capture-infrastructure-proof-of-concept/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Tauri 2.0 project</name>
  <files>Cargo.toml, src/main.rs, tauri.conf.json, src-tauri/Cargo.toml</files>
  <action>
Initialize new Tauri 2.0 project:

```bash
cargo create-tauri-app --name mtgo-replay --template vanilla --manager cargo
```

This creates the Tauri project structure with vanilla TypeScript frontend. Verify the project compiles and runs:
```bash
cargo tauri dev
```

DO NOT use Electron templates. Use vanilla template for simplicity in this phase.
  </action>
  <verify>cd mtgo-replay && cargo tauri dev (runs dev server and opens window)</verify>
  <done>Tauri application window opens with default template content</done>
</task>

<task type="auto">
  <name>Task 2: Add capture infrastructure dependencies</name>
  <files>src-tauri/Cargo.toml</files>
  <action>
Add required dependencies to src-tauri/Cargo.toml:

```bash
# Core capture dependencies
cargo add windivert windivert-sys
cargo add tauri --version "^2.0.0"
cargo add tokio --features "full"
cargo add windows --features "Win32_Security"

# Utilities
cargo add thiserror
cargo add tracing
cargo add tracing-subscriber --features "env-filter"
cargo add serde --features "derive"
```

DO NOT use libpcap or pcap alternatives - WinDivert is required for loopback capture on Windows.

Note: Platform-specific dependencies like windivert and windivert-sys use cfg(target_os = "windows") in Cargo.toml for conditional compilation. The `--target` flag is not supported by `cargo add`.

Ensure tokio has "full" features for async runtime support including MPSC channels.
  </action>
  <verify>grep -E "(windivert|tauri|tokio|windows|thiserror|tracing|serde)" src-tauri/Cargo.toml</verify>
  <done>All dependencies listed in Cargo.toml with correct versions</done>
</task>

<task type="auto">
  <name>Task 3: Verify project compilation</name>
  <files>src-tauri/main.rs</files>
  <action>
Verify the project compiles with all dependencies:
```bash
cargo check --target x86_64-pc-windows-msvc
```

If there are compilation errors:
1. Check that windivert crates are properly gated for Windows-only target
2. Verify tokio features are correctly configured
3. Ensure Tauri version matches 2.0.x

If using a non-Windows system for development (e.g., WSL or macOS):
- Add cfg(target_os = "windows") guards around WinDivert imports
- Create stub implementations for non-Windows targets to allow compilation
- This allows development on non-Windows systems while maintaining Windows-only production builds

Example cfg guard pattern:
```rust
#[cfg(target_os = "windows")]
use windivert::{layer::Network, WinDivert};

#[cfg(not(target_os = "windows"))]
mod windivert_stub {
    // Stub implementations for development
}
```

DO NOT commit platform-specific workarounds that break Windows builds. The final application is Windows-only.
  </action>
  <verify>cargo check --target x86_64-pc-windows-msvc (succeeds without errors)</verify>
  <done>Project compiles successfully on Windows target</done>
</task>

</tasks>

<verification>
- Tauri application runs in dev mode
- Window opens with basic UI
- All dependencies are properly configured
- Project compiles without errors
</verification>

<success_criteria>
Tauri 2.0 application initialized with all capture infrastructure dependencies (windivert, tokio, windows, thiserror, tracing, serde), project compiles and runs.
</success_criteria>

<output>
After completion, create `.planning/phases/01-capture-infrastructure-proof-of-concept/01-01-SUMMARY.md`
</output>
